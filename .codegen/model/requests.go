package model

import (
	"net/netip"
)

type Request struct {
	Name    string
	MsgType byte
	Fields  []Field
	Tests   []Test
}

var Requests = []Request{
	GetControllerRequest,
	SetIPv4Request,
	GetStatusRequest,
	GetTimeRequest,
}

var GetControllerRequest = Request{
	Name:    "get controller",
	MsgType: 0x94,
	Fields: []Field{
		{"controller", "uint32", 4, "controller serial number"},
	},
	Tests: []Test{
		{
			Name: "get-all-controllers",
			Args: []Arg{
				Arg{Name: "controller", Type: "uint32", Value: uint32(0)},
			},
			Expected: []byte{
				0x17, 0x94, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			},
		},
		{
			Name: "get-controller",
			Args: []Arg{
				Arg{Name: "controller", Type: "uint32", Value: uint32(405419896)},
			},
			Expected: []byte{
				0x17, 0x94, 0x00, 0x00, 0x78, 0x37, 0x2a, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			},
		},
	},
}

var SetIPv4Request = Request{
	Name:    "set IPv4",
	MsgType: 0x96,
	Fields: []Field{
		{"controller", "uint32", 4, "controller serial number"},
		{"address", "IPv4", 8, "controller IPv4 address"},
		{"netmask", "IPv4", 12, "controller IPv4 subnet mask"},
		{"gateway", "IPv4", 16, "controller IPv4 gateway address"},
		{"", "magic", 20, "'magic' word"},
	},
	Tests: []Test{
		{
			Name: "set-IPv4",
			Args: []Arg{
				Arg{Name: "controller", Type: "uint32", Value: uint32(405419896)},
				Arg{Name: "address", Type: "IPv4", Value: netip.MustParseAddr("192.168.1.125")},
				Arg{Name: "netmask", Type: "IPv4", Value: netip.MustParseAddr("255.255.255.0")},
				Arg{Name: "gateway", Type: "IPv4", Value: netip.MustParseAddr("192.168.1.1")},
			},
			Expected: []byte{
				0x17, 0x96, 0x00, 0x00, 0x78, 0x37, 0x2a, 0x18, 0xc0, 0xa8, 0x01, 0x7d, 0xff, 0xff, 0xff, 0x00,
				0xc0, 0xa8, 0x01, 0x01, 0x55, 0xaa, 0xaa, 0x55, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			},
		},
	},
}

var GetStatusRequest = Request{
	Name:    "get status",
	MsgType: 0x20,
	Fields: []Field{
		{"controller", "uint32", 4, "controller serial number"},
	},
	Tests: []Test{
		{
			Name: "get-status",
			Args: []Arg{
				Arg{Name: "controller", Type: "uint32", Value: uint32(405419896)},
			},
			Expected: []byte{
				0x17, 0x20, 0x00, 0x00, 0x78, 0x37, 0x2a, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			},
		},
	},
}

var GetTimeRequest = Request{
	Name:    "get time",
	MsgType: 0x32,
	Fields: []Field{
		{"controller", "uint32", 4, "controller serial number"},
	},
	Tests: []Test{
		{
			Name: "get-time",
			Args: []Arg{
				Arg{Name: "controller", Type: "uint32", Value: uint32(405419896)},
			},
			Expected: []byte{
				0x17, 0x32, 0x00, 0x00, 0x78, 0x37, 0x2a, 0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			},
		},
	},
}
